<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="resources/js/paho.javascript-1.0.3/paho-mqtt-min.js"></script>
    <script src="resources/js/connection.js"></script>
    <style>
        * {
	margin: 0;
	padding: 0;
    font-family: 'Avenir', sans-serif;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
}
        .main_div {
       width: 100%;
 margin: 0 auto;

  background-color: "";
  
}
table{ margin: 0 auto; width: 100%; }

table{ border-collapse: separate; border-spacing: 15px }

td{ box-shadow: 0.5px 0.5px 3px 0.5px gray; border-radius: 10px; padding-left: 10px;padding-right: 20px; padding-top:10px; padding-bottom:10px ;}

.img_td{
    width:50px;
     height:40px;
    display:block;
   
    margin-right:auto;
    
    
 }

 .caption{margin-right: 15px;margin-left: 15px;  border-bottom: 1px solid gray; margin-top: 10px; border-bottom-color: gray;

 }
 p{font-size: 13px; font-weight: bold;
}



.dot{
 
   width: 7px;
   height:7px;
   border-radius:5px 5px;
    background-color:#b4b4b0;
   margin: 0 auto;
   bottom: 0;
   }


   .dotdiv
   {
    bottom: 0;
       position: fixed;
       margin: 0 auto;
       width:100%;
       padding: 10px;
       border-top: 1px; /* Add a border at the top for separation */
       z-index: 1000; /* Ensure it stays above other content */
   
   
   }
  .water:hover,.water:active 
   {
    box-shadow: none;
    opacity: 0.2;
    background-color: #EEEEEE;
    
   }
    </style>
</head>
<body>

    <div class="main_div">
<table> <div class="caption"> <h3 style="text-align: left;margin-left: 10px;margin-bottom:10px">Home 1</h3></div>

    <tr><td id="waterpump"> <div class="dot" id="device_status"style="width: 5px; height: 5px; float:left"></div><img src="resources\image\pump.png"  class="img_td" ><p>Water Pump</p><small style="font-size: 10px;">Pump room</small></td>  
        <td id="w2" style="opacity: 0.5;"><div class="dot" id=""style="width: 5px; height: 5px; float:left"></div><img src="resources\image\power.png"  class="img_td" > <p>power Source</p><small style="font-size: 10px;">Home</small></td>
    </tr>
    <tr><td id="w3"  style="opacity: 0.5;"><div class="dot" id=""style="width: 5px; height: 5px; float:left"></div><img src="resources\image\siren.svg"  class="img_td" ><p>Siren</p><small style="font-size: 10px;">Graden</small></td>  
        <td id="w4" style="opacity: 0.5;"><div class="dot" id=""style="width: 5px; height: 5px; float:left"></div><img src="resources\image\cctv.png"  class="img_td" > <p>CCTV </p><small style="font-size: 10px;">Home</small></td>
    </tr>
   
</table>

   


    <div class="dotdiv">
        <div class="dot" id="page1"style="width: 10px; height: 10px;"></div>
        </div>

    </div>

    


    <script>
        var payload; var companyID="node"; var deviceType="spc"; var deviceID="7469308fcf871dad4d4" ;

        const subTopic = companyID+"/"+deviceType+"/"+"n2b/"+deviceID;
         var t;
        function connect(){    
        client.connect({ onSuccess: onConnect,useSSL:mqttUseSSL,userName,password});
        client.onConnectionLost = onConnectionLost;
        client.onMessageArrived = onMessageArrived;
        }
        //............................................................................................
          function onConnect() {
          console.log("onConnect");
        document.getElementById('page1').style.backgroundColor="green";
        getDataFromDevice(subTopic);
        }
        
        function onConnectionLost(responseObject) {
          if (responseObject.errorCode !== 0) {
            console.log("onConnectionLost:"+responseObject.errorMessage);
            document.getElementById('page1').style.backgroundColor="red"
            document.getElementById('device_status').style.backgroundColor="#b4b4b0";}
            setTimeout(connect, 5000);
           
        }
        function onMessageArrived(message) {
        payload=message.payloadString;
        console.log("Payload:" + payload);
        displayFunction(payload)
   
  
}


function getDataFromDevice(topic) {
    console.log("getDataFromDevice "+topic);
  //client.onMessageArrived = callbackfun;
  client.subscribe(topic+"/+");
  t=topic;
 // var message = new Paho.MQTT.Message();
 // message.destinationName = topic;
 // client.send(message);

}




function displayFunction(payload) {
      payload = JSON.parse(payload);

      switch (payload['stat'])
      {
        case "online":
        document.getElementById("device_status").style.backgroundColor="green";
      
          break;
        case "offline":
      //  document.getElementById("").style.backgroundColor="red";
         
          break;
      }
    }
        connect();
        
        window.onload=function(){
            var specifiedtag=document.querySelector('.scrollmenu a[href="index.html"]');
                if(specifiedtag){
                specifiedtag.classList.add('centered');
                specifiedtag.scrollIntoView({behavior:'smooth',block:'center'});
                }};
        
        
         document.getElementById("waterpump").onclick=function(){location.href="controller/waterpump.html"}
        
            </script>
</body>
</html>